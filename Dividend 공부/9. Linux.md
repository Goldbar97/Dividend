# Linux
대부분의 서버는 `Linux` 운영체제로 운영한다.

오픈소스 `UNIX` 계열의 운영체제이며 서버에 적합하고 리눅스 역시 무료 오픈소스이다.

리눅스를 커스텀하여 만든 `RedHat`, `Ubuntu`, `Debian` 등이 있다.

`Kernel` 을 활용해서 하드웨어를 제어할 수 있다.

## Kernel
운영체제에서 중요한 역할을 하는 커널은 컴퓨터 하드웨어 자원들을 관리하고 하드웨어와 응용 프로그램 사이에서 프로그램을 수행하는데 필요한 여러 서비스를 제공한다.

커널은 기본적으로 하드웨어를 제어하기때문에 커널과 상호작용하려면 `Shell` 명령어를 사용해야한다.

## 명령어
### 경로
```
./      : 현재 위치
../     : 현재 위치에서 한단계 상단 위치
../../  : 현재 위치에서 두단계 상단 위치

/       : 루트 경로
```

### cat
하나 이상의 파일 내용 출력
```
cat file1 file2     :file1, file2 내용 출력
cat etc/passwd      : etc 경로의 passwd 출력
```

### ls
```
현재 경로의 디렉토리 목록 열거
ls bin      : bin 디렉토리 내부의 목록
ls -l       : 상세 목록
ls -lrt     : 시간 역순 정렬 목록
```

### cd
현재 작업 중인 디렉토리 위치 변경
```
cd dir      : dir 디렉토리로 이동
```

### pwd
현재 작업 중인 디렉토리 위치 출력

### cp
파일 복사
```
cp file1 file2          : file1 을 file2 이름으로 복사
cp file1 file2 folder   : file1, file2 를 folder 디렉토리에 복사
```

### mv
파일 이동, 또는 파일명 변경
```
mv file1 file2          : file1 을 file2 로 이름 변경
mv file1 file2 folder   : file1, file2 를 folder 로 이동
```

### touch
파일 생성

이미 파일이 존재할 경우 마지막 수정 날짜 업데이트
```
touch file      : 빈 파일 생성
```

### rm
파일 삭제, 복구가 어려우므로 주의할 것
```
rm file         : file 삭제

rm -rf /dir     : dir 디렉토리와 디렉토리 내 모든 파일 삭제

rm -rf *        : 절대 사용 금지
```

### mkdir
새로운 디렉토리 생성
```
mkdir folder
```

### grep
표현과 일치하는 입력 스트림 라인 출력
```
grep root /etc/*        : "root" 단어를 포함하는 etc 디렉토리 내 모든 파일 확인

cat file | grep "ERROR" : file 내 "ERROR" 가 포함된 라인 출력
```

### head
파일의 첫 부분 10 라인(default) 내용 확인
```
head file       : file 의 10줄 확인 

head -n 5 file  : file 의 5줄 확인
```

### tail
파일의 끝 부분 10 라인(default) 내용 확인
```
tail file           : file 의 마지막 10줄 확인

tail -n 100 file    : file 의 마지막 100줄 확인

tail -f file        : 실시간으로 file 의 업데이트된 부분 출력
(파일의 끝부분 읽는 기능 안함)
```

### wc
파일의 행, 단어 수 출력
```
wc file         : file 의 행, 단어 수 출력

wc -l file      : file 의 행 수 출력

wc -w file      : file 의 단어 수 출력
```

### pipe
명령어 조합 및 연결
```
cat /etc/hosts | grep localhost  : 앞 명령어의 결과를 기반으로 뒤 명령어 실행
```

## 계정
서버에 접근하는 계정에 따라 권한을 다르게 정할 수 있다.

크게 두 가지의 계정이 있다.
- 루트 계정
- 사용자 계정

루트 계정은 관리자로서 작동하며 사용자 계정에 권한을 부여한다.

### 사용자 추가
```
useradd name
```

### 현재 사용자 조회
```
whoami
```

### 사용자 조회
```
cat /etc/passwd

[사용자명]:[비밀번호]:[uid]:[gid]:[계정설명]:[홈디렉토리]:[셸] 순으로 출력된다.
```
uid 는 유저 아이디, gid 는 그룹 아이디이다.

그룹은 사용자를 묶어서 관리하는 단위이다.

### 그룹 추가
```
groupadd new_group
```

### 그룹 조회
```
cat /etc/group
```

### 그룹에 신규 사용자 추가
```
useradd -g groupId name
```

### 계정 전환
```
su -    : root 계정으로 전환
su name : name 계정으로 전환
```

## 권한
`ls -l` 을 입력하면 다음과 같은 출력을 볼 수 있다.
```
-rw-r--r-- 1 user group 1024 Apr  6 10:00 example.txt
drwxr-xr-x 2 user group 4096 Apr  6 09:55 directory
```

각 의미는 다음과 같다.

| 권한 | 링크 수 | 소유자 | 그룹 | 크기 | 마지막 수정 시간 | 이름 |

> 끝에 `@` 이 붙은 경우는 `macOS` 에서만 나타나며 추가적인 속성이 있음을 알려준다. 

첫 열에 `drwxr-xr-x` 와 같은 문자열이 있다.

패턴은 `-|---|---|---` 이며 각 문자는 다음을 의미한다.
```
첫 번째: 유형
d   : 디렉토리
-   : 파일
l   : 링크

두 번째: 해당 소유자 권한
세 번째: 해당 그룹 권한
네 번째: 기타 사용자 권한
r   : read
w   : write
x   : execute
-   : 해당 위치의 권한 없음
```

권한은 3비트 2진수로 표현될 수 있다.

|Value|Permission|Desc|
|---|---|---|
|0|---|권한 없음|
|1|--x|실행|
|2|-w-|쓰기|
|3|-wx|쓰기/실행|
|4|r--|읽기|
|5|r-x|읽기/실행|
|6|rw-|읽기/쓰기|
|7|rwx|모든 권한|

따라서 권한을 부여하는 명령어로 `chmod` 를 사용할 수 있다.

### chmod
```
chmod -R 755 file   : -/rwx/r-x/r-x
chmod -R 644 dir    : d/rw-/r--/r--
```

### chown
파일/디렉토리의 소유자 / 그룹을 변경한다.
```
chown user:group example.txt    : example.txt 의 소유자/그룹 변경
chown -R user:group dir         : dir 디렉토리 하위의 모든 파일 소유자/그룹 변경
```

## Shell 스크립트
`Shell` 에서 작동하도록 작성된 스크립트이며 확장자명은 `.sh` 이다.

주로 서버에서 반복해서 실행되어야 하는 작업들을 작성한다.

### Shebang
스크립트 파일의 첫 줄에 있는 특수한 주석이다.

`#!` 으로 시작하며 해당 스크립트를 실행하기 위한 인터프리터의 경로가 따라온다.

```
#!/bin/bash
```

이 경우 이 스크립트는 `Bash` 셸에서 실행되어야 함을 나타낸다.

`Shebang` 주석을 통해 어떤 프로그램을 사용해서 스크립트를 실행해야 할지 자동으로 결정할 수 있다.

### Echo
문자열을 출력할 때 사용하는 명령어이다.

- `echo.sh`
    ```
    #!/bin/sh

    echo "Hello World"
    ```

`echo.sh` 을 실행하면 `Hello World` 이 표시된다.

### 변수 선언
스크립트 내부에서 변수를 선언하고 사용할 수 있다.

- `var.sh`
    ```
    #!/bin/sh

    NAME='app'
    VER='1.0'

    java -jar $NAME-$VER.jar
    ```

띄어쓰기를 하지 않고 할당하며 대소문자를 구분한다.

실행하면 `java jar app-1.0.jar` 명령어를 사용하게 된다.

### $
`$` 는 셸에서 다양한 기능을 한다.

- 변수
    
    `$` 뒤에 변수명을 붙여 해당 변수의 값을 참조한다.
    
    예를 들어, `name="John"` 이라는 변수를 정의하고 `echo $name` 을 실행하면 "John"이 출력된다.

- 환경 변수
    
    `$` 뒤에 환경 변수명을 붙여 해당 환경 변수의 값을 참조한다. 
    
    예를 들어, `$HOME`은 현재 사용자의 홈 디렉터리를 나타낸다.

- 프로세스 ID

    `$` 뒤에 `$$`를 사용하여 현재 실행 중인 프로세스의 ID를 얻을 수 있다.

- 특수 매개변수

    `$` 뒤에 숫자나 특정 문자열을 사용하여 스크립트에서 특수 매개변수에 접근할 수 있다.
    
    예를 들어, `$0`은 현재 실행 중인 스크립트의 이름을 나타낸다.

- 명령어 치환
    
    `$()` 또는 ''를 사용하여 명령어를 실행하고 그 결과를 변수에 할당하거나 다른 명령어와 함께 사용할 수 있다. 
    
    예를 들어, `output=$(ls)`는 현재 디렉터리의 파일 목록을 가져와서 output 변수에 할당한다.

- 수학 연산

    `$(( ))`를 사용하여 산술 연산을 수행할 수 있다.
    
    예를 들어, `result=$((2 + 2))` 는 2와 2를 더한 결과를 result 변수에 할당한다.

특수 매개변수의 예시는 다음과 같다.

- `$0`
    
    현재 실행 중인 스크립트의 이름을 나타낸다.

- `$1, $2, ..., $n`

    스크립트나 함수에 전달된 인수(argument)들을 나타낸다.
    
    $1은 첫 번째 인수, $2는 두 번째 인수를 의미한다.

- `$@`

    스크립트에 전달된 모든 인수를 나타낸다.
    
    각 인수는 따로따로 따옴표로 묶여 배열 형태로 전달된다.

- `$*`

    `$@`와 비슷하지만, 전체 인수를 하나의 문자열로 취급한다.

- `$#`

    스크립트에 전달된 인수의 개수를 나타낸다.

- `$?`

    이전 명령어의 종료 상태(exit status)를 나타낸다.
    
    보통 0은 성공을 의미하고, 다른 값은 실패를 나타낸다.

- `$$`

    현재 셸 스크립트나 프로그램의 프로세스 ID를 나타낸다.

- `$!`

    백그라운드로 실행된 마지막 명령어의 프로세스 ID를 나타낸다.

스크립트를 실행할 때 파라미터를 전달하려면 `test.sh hello world` 같이 띄어쓰기로 구분한다.

그러면 내부에서 `$1` 로 `hello` 를 참조할 수 있다.

### If 문
조건문을 사용할 수 있다.

```shell
#!/bin/bash

if [condition]
then
    ...
else
    ...
fi
```

condition 은 다음과 같이 작성할 수 있다.

- `"$variable" = "value"`: 같은 지 확인
- `-e "$file"`: 파일 존재 유무 확인
- `-d "$dir"`: 디렉토리 존재 유무 확인
- `"$num1" -gt "$num2"`: 숫자 비교
- `"$str1" \< "$str2"`: 문자열 비교 (사전순)

    보통 `<` 는 리다이렉션 특수기호이므로 이스케이프를 붙인다.

### For 문
반복문을 사용할 수 있다.

```shell
#!/bin/bash

for VAR in LIST
do
    ...
done
```

`for f in $(ls)` 를 사용하면 `ls` 를 실행한 결과 목록들을 하나씩 `f` 로 가져온다.

### While 문
```shell
#!/bin/bash

while [condition]
do

done
```