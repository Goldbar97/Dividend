# Docker
서비스를 배포할 때 `Docker` 를 사용해서 배포하려 한다.

그 전에 서비스 배포가 무엇인지 알아보자.

## 서비스 배포
프로젝트를 진행하면서 로컬 서버인 `localhost:8080` 으로 API 테스트를 했다.

하지만 클라이언트는 로컬 서버 주소로 서비스를 이용할 수 없다.

사용자들이 사용할 수 있는 형태로 변환해서 서버 환경에 배포해야하는데 이 과정을 서비스 배포라고 한다.

서비스 배포에도 다양한 방법이 있고 이걸 이해하려면 서버 인프라 지식이 필요하다.

우선 모든 장비를 구비해두고 서버를 운영하는 `On-Premise` 방식과 장비가 구비된 서버를 빌려서 원격으로 운영하는 `Cloud` 방식이 있다.

서버를 효율적으로 사용하는 기술 중 `Virtualization` 이 있다.

컴퓨터 자원을 논리적으로 분할해서 여러 개의 가상 환경을 만들어서 다양한 운영 체제나 애플리케이션을 실행하는 기술이다.

`Virtual Machine` 이라는 소프트웨어를 활용해서 하나의 하드웨어로 다수의 가상 환경을 실행시킨다.

가상 머신은 독립적으로 관리되므로 서버 관리가 용이하고 비용을 절감할 수 있으며 환경에 따라 필요한 운영체제를 자유롭게 선택할 수 있다.

CPU 사용률과 디스크 I/O 및 사용 용량을 기준으로 가상화를 진행해서 하드웨어 자원을 최대한 활용하도록 한다.

## Docker 를 사용하는 이유
`Docker` 는 가상화 기술 중 하나로써 컨테이너 기반의 가상화를 제공하는 프로그램이다.

`Docker` 는 다음과 같은 장점이 있다.
- 많은 사용자
- 운영 표준화
- 높은 이식성
- 비용 절감

컨테이너형으로 관리되므로 배포, 운영이 쉽고 표준화된 실행 환경을 포함하므로 일관된 결과를 보장받을 수 있다.

또한 컨테이너 개념덕분에 `On-Premise` 에서 `Cloud` 로 이전이 쉽고 운영체제간 이전도 쉽다.

## 컨테이너
추상화된 개념으로, 시스템에 영향을 주지 않는 격리된 공간이다.

실행환경, 라이브러리, 시스템 도구 그리고 코드 등을 포함한다.

컨테이너는 `이미지` 로부터 생성된다.

컨테이너 생성과 관련된 내용이 포함된 템플릿이며 `READ-ONLY` 속성을 가진다.

`Docker Registry` 에서 다른 사람이 제작한 이미지를 받아 써볼 수 있고 직접 이미지를 만들어서 업로드 할 수 있다.

운영체제마다 환경설정을 해줘야하는 번거로움을 이미지를 다운받는 것만으로 해결할 수 있다.

레지스트리에서 받아온 이미지는 컨테이너형태로 실행된다.

## Docker 와 VM 의 다른점
도커는 하나의 `Guest OS` 위에 `Docker Engine` 이 수많은 컨테이너를 구동하는 방식이다.

이에 반해 VM 은 하나의 가상 환경마다 하나의 `Guest OS` 가 포함되므로 도커에 비해 무겁다.

## Docker 명령어
```
docker image pull   // 레지스트리에서 이미지 가져오기
docker image rm     // 이미지 제거
docker image ls     // 이미지 조회
docker images       // 이미지 조회
docker build        // 도커 파일로부터 이미지 빌드

docker start CONTAINER_ID   // 생성한 컨테이너 실행
docker restart CONTAINER_ID // 생성한 컨테이너 재실행
docker stop CONTRAINER_ID   // 생성한 컨테이너 정지

docker run [OPTIONS] IMAGE  // 컨테이너 생성 + 실행

docker ps   // 컨테이너 리스트 및 상태 조회

docker exec -it CONTAINER_ID /bin/bash  // 실행중인 컨테이너에 명령어 실행

docker logs CONTAINER   // 컨테이너 로그 확인
```

## Docker 설치
윈도우를 사용하므로 윈도우 전용 `Docker Desktop` 을 다운받았다.

그런데 윈도우 전용 가상 머신인 `Hyper-V` 가 작동 불가라는 오류가 발생한다.

`cmd` 에서 `systeminfo` 를 입력하고 `Hyper-V 요구 사항: 펌웨어에 가상화 사용: 예` 인지 확인한다.

`아니요` 의 경우 `UEFI BIOS` 진입 후 가상 기술을 허용하도록 설정을 바꿔야 한다.

그 후 `Windows 기능 켜기/끄기` 를 검색해서 `Hyper-V` 를 모두 체크한다.

재부팅하고 `Docker` 를 다시 설치하면 정상 작동한다.

## Docker 사용해보기
`Docker Desktop` 이 실행됐는지 확인하고 `Windows PowerShell` 를 열어 명령어를 입력한다.

`docker image pull mysql` 을 입력하면 리포지토리에서 최신 버전의 이미지를 다운받는다.

`docker images` 를 입력해서 설치가 됐는지 확인한다.

이제 다운받은 이미지로 컨테이너를 생성하자.

```
docker run --name mysql -container -e MYSQL_ROOT_PASSWORD=test -d -p 3306:3306 mysql:latest
```

강의에서는 잘못된 명령어를 입력해서 작동이 안되므로 다음을 입력한다.

```
docker run --name mysql -d -e MYSQL_ROOT_PASSWORD=test -p 3306:3306 mysql:latest
```

입력하면 `Docker` 의 `ID` 가 출력된다.

`docker ps` 로 실행중인 컨테이너를 조회해보자.

실행중인 컨테이너의 `ID` 와 `PORT` 등 정보를 볼 수 있다.

강의에서 사용하는 `-container` 명령어는 작동되지 않는다.

컨테이너에 접근하고 쉘 커맨드를 사용하기 위해 다음과 같이 작성한다.

```
docker exec -it mysql /bin/sh
```

그러면 프롬프트가 `sh-4.4#` 로 바뀌고 이것은 해당 컨테이너의 내부에 접속했음을 표시한다.

디렉토리를 확인하는 명령어인 `ls` 와 디렉토리를 이동하는 `cd` 를 사용하면 자유롭게 이동할 수 있다.

`etc` 로 이동한 후 `ls` 를 입력하면 `mysql` 이 있는 것을 확인할 수 있다.

`mysql -u root -p` 를 입력해서 접속한다.

이 때 한번에 비밀번호까지 입력하면 명령어 기록이 남고 비밀번호가 노출되므로 `Enter password:` 상태에서 비밀번호를 입력한다.

입력 커서가 움직이지 않아도 입력되는 상태이므로 비밀번호로 지정한 `test` 를 입력하고 엔터를 누른다.

그러면 프롬프트가 `mysql>` 로 바뀌고 내부에서 `SQL문` 을 사용할 수 있게 된다.

해당 프롬프트에서 나가려면 `exit` 를 입력하면 된다.